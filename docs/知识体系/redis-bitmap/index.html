<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Redis bitmap - Learn &amp; Record</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Learn &amp; Record"><meta name="msapplication-TileImage" content="/gallery/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Learn &amp; Record"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="原文：https:&amp;#x2F;&amp;#x2F;haicoder.net&amp;#x2F;note&amp;#x2F;redis-interview&amp;#x2F;redis-interview-redis-bitmap.html 什么是Redis bitmapRedis 的 bitmap 是通过一个 bit 位来表示某个元素对应的值或者状态，其中的 key 就是对应元素本身。Bitmaps 本身不是一种数据结构，实际上它就是字符串（key 对应的 value 就是上图"><meta property="og:type" content="blog"><meta property="og:title" content="Redis bitmap"><meta property="og:url" content="https://wangdj2020.github.io/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis-bitmap/"><meta property="og:site_name" content="Learn &amp; Record"><meta property="og:description" content="原文：https:&amp;#x2F;&amp;#x2F;haicoder.net&amp;#x2F;note&amp;#x2F;redis-interview&amp;#x2F;redis-interview-redis-bitmap.html 什么是Redis bitmapRedis 的 bitmap 是通过一个 bit 位来表示某个元素对应的值或者状态，其中的 key 就是对应元素本身。Bitmaps 本身不是一种数据结构，实际上它就是字符串（key 对应的 value 就是上图"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134905.png"><meta property="og:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134907.png"><meta property="og:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134912.png"><meta property="og:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134915.png"><meta property="og:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134919.png"><meta property="article:published_time" content="2021-04-12T13:58:27.000Z"><meta property="article:author" content="王东杰"><meta property="article:tag" content="redis"><meta property="article:tag" content="2021"><meta property="article:tag" content="redis 进阶"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134905.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://wangdj2020.github.io/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis-bitmap/"},"headline":"Redis bitmap","image":["https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134905.png","https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134907.png","https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134912.png","https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134915.png","https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134919.png"],"datePublished":"2021-04-12T13:58:27.000Z","author":{"@type":"Person","name":"王东杰"},"description":"原文：https:&#x2F;&#x2F;haicoder.net&#x2F;note&#x2F;redis-interview&#x2F;redis-interview-redis-bitmap.html 什么是Redis bitmapRedis 的 bitmap 是通过一个 bit 位来表示某个元素对应的值或者状态，其中的 key 就是对应元素本身。Bitmaps 本身不是一种数据结构，实际上它就是字符串（key 对应的 value 就是上图"}</script><link rel="canonical" href="https://wangdj2020.github.io/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis-bitmap/"><link rel="icon" href="/gallery/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Learn &amp; Record</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-12T13:58:27.000Z" title="2021/4/12下午9:58:27">2021-04-12</time>发表</span><span class="level-item"><a class="link-muted" href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></span><span class="level-item">19 分钟读完 (大约2858个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Redis bitmap</h1><div class="content"><p>原文：https://haicoder.net/note/redis-interview/redis-interview-redis-bitmap.html</p>
<h2 id="什么是Redis-bitmap"><a href="#什么是Redis-bitmap" class="headerlink" title="什么是Redis bitmap"></a>什么是Redis bitmap</h2><p><strong><a target="_blank" rel="noopener" href="https://haicoder.net/redis/redis-tutorial.html">Redis</a></strong> 的 bitmap 是通过一个 bit 位来表示某个元素对应的值或者状态，其中的 key 就是对应元素本身。Bitmaps 本身不是一种数据结构，实际上它就是字符串（key 对应的 value 就是上图中最后的一串二进制），但是它可以对字符串的位进行操作。</p>
<p>Bitmaps 单独提供了一套命令，所以在 Redis 中使用 Bitmaps 和使用字符串的方法不太相同。可以把 Bitmaps 想象成一个以 “位” 为单位的数组，数组的每个单元只能存储 0 和 1，数组的下标在 Bitmaps 中叫做偏移量。</p>
<span id="more"></span>

<h2 id="bitmap特点"><a href="#bitmap特点" class="headerlink" title="bitmap特点"></a>bitmap特点</h2><p>Bitmaps 本身不是一种数据结构， 实际上它就是字符串，但是它可以对字符串的位进行操作。</p>
<p>Bitmaps 单独提供了一套命令， 所以在 Redis 中使用 Bitmaps 和使用字符串的方法不太相同。 可以把 Bitmaps 想象成一个以位为单位的数组， 数组的每个单元只能存储 0 和 1，数组的下标在 Bitmaps 中叫做偏移量。</p>
<h2 id="bitmap优缺点"><a href="#bitmap优缺点" class="headerlink" title="bitmap优缺点"></a>bitmap优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>基于最小的单位 bit 进行存储，所以非常省空间。</li>
<li>设置时候时间复杂度 O(1)、读取时候时间复杂度 O(n)，操作是非常快的。</li>
<li>二进制数据的存储，进行相关计算的时候非常快。</li>
<li>方便扩容。</li>
</ol>
<h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><p>redis 中 bit 映射被限制在 512MB 之内，所以最大是 2^32 位。建议每个 key 的位数都控制下，因为读取时候时间复杂度 O(n)，越大的串读的时间花销越多。</p>
<h2 id="bitmap命令详解"><a href="#bitmap命令详解" class="headerlink" title="bitmap命令详解"></a>bitmap命令详解</h2><h3 id="设置值SETBIT"><a href="#设置值SETBIT" class="headerlink" title="设置值SETBIT"></a>设置值SETBIT</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETBIT key offset value</span><br></pre></td></tr></table></figure>

<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。位的设置或清除取决于 value 参数，可以是 0 也可以是 1 。当 key 不存在时，自动生成一个新的字符串值。</p>
<p>字符串会进行伸展(grown)以确保它可以将 value 保存在指定的偏移量上。当字符串值进行伸展时，空白位置以 0 填充。offset 参数必须大于或等于 0 ，小于 2^32 (bit 映射被限制在 512 MB 之内)。对使用大的 offset 的 SETBIT 操作来说，内存分配可能造成 Redis 服务器被阻塞。</p>
<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>字符串值指定偏移量上原来储存的位(bit)。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p><img src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134905.png" alt="26_redis bitmaps.png"></p>
<p>从以上示例我们可以看出，我们使用 SETBIT 命令可以设置某个位的值，如果没有设置值的位默认值为 0，同时，SETBIT 只能设置 0 和 1，我们设置了 2，提示我们出错了。</p>
<h3 id="获取值GETBIT"><a href="#获取值GETBIT" class="headerlink" title="获取值GETBIT"></a>获取值GETBIT</h3><h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GETBIT key offset</span><br></pre></td></tr></table></figure>

<h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>对 key 所储存的字符串值，获取指定偏移量上的位(bit)。当 offset 比字符串值的长度大，或者 key 不存在时，返回 0。</p>
<h4 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h4><p>字符串值指定偏移量上的位(bit)。</p>
<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p><img src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134907.png" alt="27_redis bitmaps.png"></p>
<p>从以上示例我们可以看出，我们使用 SETBIT 命令可以设置某个位的值，使用 GETBIT 可以获取某个位的值。</p>
<h3 id="获取值为1个数BITCOUNT"><a href="#获取值为1个数BITCOUNT" class="headerlink" title="获取值为1个数BITCOUNT"></a>获取值为1个数BITCOUNT</h3><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT key start</span><br></pre></td></tr></table></figure>

<h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><p>计算给定字符串中，被设置为 1 的比特位的数量。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。</p>
<p>start 和 end 参数的设置和 <strong>GETRANGE</strong> 命令类似，都可以使用负数值： 比如 -1 表示最后一个字节，-2 表示倒数第二个字节，以此类推。不存在的 key 被当成是空字符串来处理，因此对一个不存在的 key 进行 BITCOUNT 操作，结果为 0。</p>
<h4 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h4><p>被设置为 1 的位的数量。</p>
<h4 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h4><p><img src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134912.png" alt="28_redis bitmaps.png"></p>
<p>从以上示例我们可以看出，我们使用 SETBIT 命令设置某个位的值，最后我们使用 BITCOUNT 可以获取被设置为 1 的位的个数。</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>BITCOUNT 命令返回的是一个指定 key 中位的值为 1 的个数(是以 byte 为单位不是 bit)”，这就是坑的所在。所以 bitcount 0 0 那么就应该是第一个 “字节” 中 1 的数量的，注意是字节，第一个字节也就是 1,2,3,4,5,6,7,8 这八个位置上。</p>
<h3 id="bitmap运算BITOP"><a href="#bitmap运算BITOP" class="headerlink" title="bitmap运算BITOP"></a>bitmap运算BITOP</h3><h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITOP operation destkey key [key ...]</span><br></pre></td></tr></table></figure>

<h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><p>对一个或多个保存二进制位的字符串 key 进行位元操作，并将结果保存到 destkey 上。operation 可以是 AND 、 OR 、 NOT 、 XOR 这四种操作中的任意一种：</p>
<ul>
<li>BITOP AND destkey key [key …] ，对一个或多个 key 求逻辑并，并将结果保存到 destkey。</li>
<li>BITOP OR destkey key [key …] ，对一个或多个 key 求逻辑或，并将结果保存到 destkey。</li>
<li>BITOP XOR destkey key [key …] ，对一个或多个 key 求逻辑异或，并将结果保存到 destkey。</li>
<li>BITOP NOT destkey key ，对给定 key 求逻辑非，并将结果保存到 destkey。</li>
</ul>
<p>除了 NOT 操作之外，其他操作都可以接受一个或多个 key 作为输入。当 BITOP 处理不同长度的字符串时，较短的那个字符串所缺少的部分会被看作 0。空的 key 也被看作是包含 0 的字符串序列。</p>
<h4 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h4><p>保存到 destkey 的字符串的长度，和输入 key 中最长的字符串长度相等。</p>
<h4 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h4><p>AND 操作具体如下：</p>
<p><img src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134915.png" alt="29_redis bitmaps.png"></p>
<p>从以上示例我们可以看出，使用 BITOP 可以操作两个或者多个 bitmaps，并且只有两位都是 1 时，结果对应的位才为 1。</p>
<h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><p>BITOP 的复杂度为 O(N) ，当处理大型矩阵(matrix)或者进行大数据量的统计时，最好将任务指派到附属节点(slave)进行，避免阻塞主节点。</p>
<h3 id="计算偏移量"><a href="#计算偏移量" class="headerlink" title="计算偏移量"></a>计算偏移量</h3><h4 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITPOS key bit [start][end]</span><br></pre></td></tr></table></figure>

<h4 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h4><p>返回字符串里面第一个被设置为 1 或者 0 的 bit 位。返回一个位置，把字符串当做一个从左到右的字节数组，第一个符合条件的在位置 0，其次在位置 8，等等。</p>
<p>GETBIT 和 SETBIT 相似的也是操作字节位的命令。默认情况下整个字符串都会被检索一次，只有在指定 start 和 end 参数(指定 start 和 end 位是可行的)，该范围被解释为一个字节的范围，而不是一系列的位。所以 start=0 并且 end=2 是指前三个字节范围内查找。</p>
<p>注意，返回的位的位置始终是从 0 开始的，即使使用了 start 来指定了一个开始字节也是这样。和 GETRANGE 命令一样，start 和 end 也可以包含负值，负值将从字符串的末尾开始计算，-1 是字符串的最后一个字节，-2 是倒数第二个，等等。不存在的 key 将会被当做空字符串来处理。</p>
<h4 id="返回值-4"><a href="#返回值-4" class="headerlink" title="返回值"></a>返回值</h4><p>命令返回字符串里面第一个被设置为 1 或者 0 的 bit 位。如果我们在空字符串或者 0 字节的字符串里面查找 bit 为 1 的内容，那么结果将返回 -1。如果我们在字符串里面查找 bit 为 0 而且字符串只包含 1 的值时，将返回字符串最右边的第一个空位。</p>
<p>如果有一个字符串是三个字节的值为 0xff 的字符串，那么命令 BITPOS key 0 将会返回 24，因为 0-23 位都是 1。基本上，我们可以把字符串看成右边有无数个 0。然而，如果你用指定 start 和 end 范围进行查找指定值时，如果该范围内没有对应值，结果将返回 -1。</p>
<h4 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h4><p><img src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-134919.png" alt="30_redis bitmaps.png"></p>
<p>我们首先使用了 SETBIT 设置位的值，接着，我们分别使用了 BITPOS 获取了第一个 1 的偏移量和第一位为 0 的偏移量，我们可以看出，第一个为 1 的偏移量就是我们设置的 100.</p>
<h2 id="bitmap使用场景"><a href="#bitmap使用场景" class="headerlink" title="bitmap使用场景"></a>bitmap使用场景</h2><h3 id="视频属性的无限延伸"><a href="#视频属性的无限延伸" class="headerlink" title="视频属性的无限延伸"></a>视频属性的无限延伸</h3><h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><p>一个拥有亿级数据量的短视频 app，视频存在各种属性(是否加锁、是否特效等等)，需要做各种标记。</p>
<h4 id="可能想到的解决方案"><a href="#可能想到的解决方案" class="headerlink" title="可能想到的解决方案"></a>可能想到的解决方案</h4><ol>
<li>存储在 <strong><a target="_blank" rel="noopener" href="https://haicoder.net/mysql/database-course.html">mysql</a></strong> 中，肯定不行，一个是随着业务增长属性一直增加，并且存在有时间限制的属性，直接对数据库进行加减字段是非常不合理的做法。即使是存在一个字段中用 <strong><a target="_blank" rel="noopener" href="https://haicoder.net/json/json-tutorial.html">json</a></strong> 等压缩技术存储也存在读效率的问题，并且对于大几亿的数据来说，废弃的字段回收起来非常麻烦。</li>
<li>直接记录在 redis 中，根据业务属性＋uid 为 key 来存储。读写效率角度没毛病，但是存储的角度来说key的数据量都大于 value 了，太耗费空间了。即使是用 json 等压缩技术来存储。也存在问题，解压需要时间，并且大几亿的数据回收也是难题。</li>
</ol>
<h4 id="设计方案"><a href="#设计方案" class="headerlink" title="设计方案"></a>设计方案</h4><p>使用 redis 的 bitmap 进行存储。key 由属性 id＋视频分片 id 组成。value 按照视频 id 对分片范围取模来决定偏移量 offset。10 亿视频一个属性约 120m 还是挺划算的。</p>
<h3 id="用户在线状态"><a href="#用户在线状态" class="headerlink" title="用户在线状态"></a>用户在线状态</h3><h4 id="需求描述-1"><a href="#需求描述-1" class="headerlink" title="需求描述"></a>需求描述</h4><p>需要对子项目提供一个接口，来提供某用户是否在线？</p>
<h4 id="设计方案-1"><a href="#设计方案-1" class="headerlink" title="设计方案"></a>设计方案</h4><p>使用 bitmap 是一个节约空间效率又高的一种方法，只需要一个 key，然后用户 id 为偏移量 offset，如果在线就设置为 1，不在线就设置为 0，3 亿用户只需要 36MB 的空间。</p>
<h3 id="统计活跃用户"><a href="#统计活跃用户" class="headerlink" title="统计活跃用户"></a>统计活跃用户</h3><h4 id="需求描述-2"><a href="#需求描述-2" class="headerlink" title="需求描述"></a>需求描述</h4><p>需要计算活跃用户的数据情况。</p>
<h4 id="设计方案-2"><a href="#设计方案-2" class="headerlink" title="设计方案"></a>设计方案</h4><p>使用时间作为缓存的 key，然后用户 id 为 offset，如果当日活跃过就设置为 1。之后通过 bitOp 进行二进制计算算出在某段时间内用户的活跃情况。</p>
<h3 id="用户签到"><a href="#用户签到" class="headerlink" title="用户签到"></a>用户签到</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>用户需要进行签到，对于签到的数据需要进行分析与相应的运运营策略。</p>
<h4 id="设计方案-3"><a href="#设计方案-3" class="headerlink" title="设计方案"></a>设计方案</h4><p>使用 redis 的 bitmap，由于是长尾的记录，所以 key 主要由 uid 组成，设定一个初始时间，往后每加一天即对应 value 中的 offset 的位置。</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/redis/">redis</a><a class="link-muted mr-2" rel="tag" href="/tags/2021/">2021</a><a class="link-muted mr-2" rel="tag" href="/tags/redis-%E8%BF%9B%E9%98%B6/">redis 进阶</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis-hyperloglog/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Redis HyperLoglog</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis-16%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-item">Redis 16个数据库</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://wdj-1252419878.cos.ap-beijing.myqcloud.com/blog/2021-04-12-011456.jpg" alt="王东杰"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">王东杰</p><p class="is-size-6 is-block">Time is limited.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国 北京</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">11</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wangdj2020/" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wangdj2020/"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#什么是Redis-bitmap"><span class="level-left"><span class="level-item">1</span><span class="level-item">什么是Redis bitmap</span></span></a></li><li><a class="level is-mobile" href="#bitmap特点"><span class="level-left"><span class="level-item">2</span><span class="level-item">bitmap特点</span></span></a></li><li><a class="level is-mobile" href="#bitmap优缺点"><span class="level-left"><span class="level-item">3</span><span class="level-item">bitmap优缺点</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#优点"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">优点</span></span></a></li><li><a class="level is-mobile" href="#限制"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">限制</span></span></a></li></ul></li><li><a class="level is-mobile" href="#bitmap命令详解"><span class="level-left"><span class="level-item">4</span><span class="level-item">bitmap命令详解</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#设置值SETBIT"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">设置值SETBIT</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#语法"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">语法</span></span></a></li><li><a class="level is-mobile" href="#说明"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">说明</span></span></a></li><li><a class="level is-mobile" href="#返回值"><span class="level-left"><span class="level-item">4.1.3</span><span class="level-item">返回值</span></span></a></li><li><a class="level is-mobile" href="#示例"><span class="level-left"><span class="level-item">4.1.4</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#获取值GETBIT"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">获取值GETBIT</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#语法-1"><span class="level-left"><span class="level-item">4.2.1</span><span class="level-item">语法</span></span></a></li><li><a class="level is-mobile" href="#说明-1"><span class="level-left"><span class="level-item">4.2.2</span><span class="level-item">说明</span></span></a></li><li><a class="level is-mobile" href="#返回值-1"><span class="level-left"><span class="level-item">4.2.3</span><span class="level-item">返回值</span></span></a></li><li><a class="level is-mobile" href="#示例-1"><span class="level-left"><span class="level-item">4.2.4</span><span class="level-item">示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#获取值为1个数BITCOUNT"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">获取值为1个数BITCOUNT</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#语法-2"><span class="level-left"><span class="level-item">4.3.1</span><span class="level-item">语法</span></span></a></li><li><a class="level is-mobile" href="#说明-2"><span class="level-left"><span class="level-item">4.3.2</span><span class="level-item">说明</span></span></a></li><li><a class="level is-mobile" href="#返回值-2"><span class="level-left"><span class="level-item">4.3.3</span><span class="level-item">返回值</span></span></a></li><li><a class="level is-mobile" href="#示例-2"><span class="level-left"><span class="level-item">4.3.4</span><span class="level-item">示例</span></span></a></li><li><a class="level is-mobile" href="#注意"><span class="level-left"><span class="level-item">4.3.5</span><span class="level-item">注意</span></span></a></li></ul></li><li><a class="level is-mobile" href="#bitmap运算BITOP"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">bitmap运算BITOP</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#语法-3"><span class="level-left"><span class="level-item">4.4.1</span><span class="level-item">语法</span></span></a></li><li><a class="level is-mobile" href="#说明-3"><span class="level-left"><span class="level-item">4.4.2</span><span class="level-item">说明</span></span></a></li><li><a class="level is-mobile" href="#返回值-3"><span class="level-left"><span class="level-item">4.4.3</span><span class="level-item">返回值</span></span></a></li><li><a class="level is-mobile" href="#示例-3"><span class="level-left"><span class="level-item">4.4.4</span><span class="level-item">示例</span></span></a></li><li><a class="level is-mobile" href="#注意-1"><span class="level-left"><span class="level-item">4.4.5</span><span class="level-item">注意</span></span></a></li></ul></li><li><a class="level is-mobile" href="#计算偏移量"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">计算偏移量</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#语法-4"><span class="level-left"><span class="level-item">4.5.1</span><span class="level-item">语法</span></span></a></li><li><a class="level is-mobile" href="#说明-4"><span class="level-left"><span class="level-item">4.5.2</span><span class="level-item">说明</span></span></a></li><li><a class="level is-mobile" href="#返回值-4"><span class="level-left"><span class="level-item">4.5.3</span><span class="level-item">返回值</span></span></a></li><li><a class="level is-mobile" href="#示例-4"><span class="level-left"><span class="level-item">4.5.4</span><span class="level-item">示例</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#bitmap使用场景"><span class="level-left"><span class="level-item">5</span><span class="level-item">bitmap使用场景</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#视频属性的无限延伸"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">视频属性的无限延伸</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#需求描述"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">需求描述</span></span></a></li><li><a class="level is-mobile" href="#可能想到的解决方案"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">可能想到的解决方案</span></span></a></li><li><a class="level is-mobile" href="#设计方案"><span class="level-left"><span class="level-item">5.1.3</span><span class="level-item">设计方案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#用户在线状态"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">用户在线状态</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#需求描述-1"><span class="level-left"><span class="level-item">5.2.1</span><span class="level-item">需求描述</span></span></a></li><li><a class="level is-mobile" href="#设计方案-1"><span class="level-left"><span class="level-item">5.2.2</span><span class="level-item">设计方案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#统计活跃用户"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">统计活跃用户</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#需求描述-2"><span class="level-left"><span class="level-item">5.3.1</span><span class="level-item">需求描述</span></span></a></li><li><a class="level is-mobile" href="#设计方案-2"><span class="level-left"><span class="level-item">5.3.2</span><span class="level-item">设计方案</span></span></a></li></ul></li><li><a class="level is-mobile" href="#用户签到"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">用户签到</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#需求分析"><span class="level-left"><span class="level-item">5.4.1</span><span class="level-item">需求分析</span></span></a></li><li><a class="level is-mobile" href="#设计方案-3"><span class="level-left"><span class="level-item">5.4.2</span><span class="level-item">设计方案</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E6%84%9F%E6%82%9F/"><span class="level-start"><span class="level-item">感悟</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/"><span class="level-start"><span class="level-item">知识体系</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">读书笔记</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-12T14:18:44.000Z">2021-04-12</time></p><p class="title"><a href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F/">Redis主从模式</a></p><p class="categories"><a href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-12T14:17:43.000Z">2021-04-12</time></p><p class="title"><a href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88/">Redis整数集合</a></p><p class="categories"><a href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-12T14:16:42.000Z">2021-04-12</time></p><p class="title"><a href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8/">Redis压缩列表</a></p><p class="categories"><a href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-12T14:15:41.000Z">2021-04-12</time></p><p class="title"><a href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">Redis线程模型</a></p><p class="categories"><a href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-04-12T14:14:26.000Z">2021-04-12</time></p><p class="title"><a href="/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB/">Redis为什么这么快</a></p><p class="categories"><a href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">二月 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/2020/"><span class="tag">2020</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/2021/"><span class="tag">2021</span><span class="tag">39</span></a></div><div class="control"><a class="tags has-addons" href="/tags/economy/"><span class="tag">economy</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/life/"><span class="tag">life</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/memory/"><span class="tag">memory</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reading/"><span class="tag">reading</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis-%E8%BF%9B%E9%98%B6/"><span class="tag">redis 进阶</span><span class="tag">27</span></a></div><div class="control"><a class="tags has-addons" href="/tags/time-management/"><span class="tag">time management</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Learn &amp; Record</a><p class="is-size-7"><span>&copy; 2021 王东杰</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>